<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultado de Cotización - TRAVELASIA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0;
            margin: 0;
        }
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .nav {
            display: flex;
            gap: 1.5rem;
        }
        .nav a {
            text-decoration: none;
            color: #34495e;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .nav a:hover {
            background-color: #f8f9fa;
            color: #3498db;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .quotation-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 1000px;
            opacity: 0;
            transform: translateY(20px);
        }
        .success-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .success-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .destination-info {
            padding: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        .info-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #eee;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        .info-item:last-child {
            border-bottom: none;
        }
        .total-line {
            border-top: 2px solid #27ae60;
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-size: 1.1rem;
            color: #2c3e50;
        }
        .price-summary {
            background: #2c3e50;
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .total-price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2ecc71;
            margin: 1rem 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .actions {
            padding: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .btn-success {
            background: #27ae60;
            color: white;
        }
        .btn-success:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        .btn-primary {
            background: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }
        .disclaimer {
            background: #fff3cd;
            color: #856404;
            padding: 1rem 2rem;
            text-align: center;
            border-top: 1px solid #ffeaa7;
        }
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            .nav {
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }
            .destination-info {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            .actions {
                flex-direction: column;
                padding: 1rem;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .info-section {
                padding: 1rem;
            }
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .quotation-card, .quotation-card * {
                visibility: visible;
            }
            .quotation-card {
                position: absolute;
                left: 0;
                top: 0;
                box-shadow: none;
                margin: 0;
                width: 100%;
            }
            .actions, .btn {
                display: none !important;
            }
            .header {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <i class="fas fa-globe-asia"></i> TRAVELASIA
        </div>
        <div class="nav">
            <a href="{{ url_for('index') }}">
                <i class="fas fa-home"></i> Inicio
            </a>
            <a href="{{ url_for('destinos') }}">
                <i class="fas fa-map-marked-alt"></i> Destinos
            </a>
            <a href="{{ url_for('cotizar') }}">
                <i class="fas fa-calculator"></i> Cotizar
            </a>
        </div>
        <div class="user-info">
            {% if session.user_name %}
                <i class="fas fa-user-circle"></i> 
                <span>{{ session.user_name }}</span>
            {% else %}
                <a href="{{ url_for('login') }}" style="text-decoration: none; color: #3498db;">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </a>
            {% endif %}
        </div>
    </div>

    <div class="container">
        <div class="quotation-card">
            <div class="success-header">
                <div class="success-icon"><i class="fas fa-check-circle"></i></div>
                <h1>¡Cotización Generada Exitosamente!</h1>
                <p>Tu viaje a Asia está casi listo. Revisa los detalles de tu cotización:</p>
            </div>

            <div class="destination-info">
                <div class="info-section">
                    <h3><i class="fas fa-calendar-alt"></i> Información del Viaje</h3>
                    <div class="info-item">
                        <span>Tour:</span>
                        <strong>{{ tour.nombre }}</strong>
                    </div>
                    <div class="info-item">
                        <span>País:</span>
                        <span>{{ tour.pais }}</span>
                    </div>
                    <div class="info-item">
                        <span>Ciudades:</span>
                        <span>{{ tour.ciudad }}</span>
                    </div>
                    <div class="info-item">
                        <span>Duración:</span>
                        <span>{{ tour.duracion }}</span>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-users"></i> Detalles de la Cotización</h3>
                    <div class="info-item">
                        <span>Personas:</span>
                        <span>{{ datos.personas }}</span>
                    </div>
                    <div class="info-item">
                        <span>Noches:</span>
                        <span>{{ datos.noches }}</span>
                    </div>
                    <div class="info-item">
                        <span>Categoría:</span>
                        <span>{{ datos.categoria.title() }}</span>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-concierge-bell"></i> Servicios Incluidos</h3>
                    {% for servicio in tour.incluye %}
                    <div class="info-item">
                        <span>{{ servicio }}</span>
                        <span style="color: #27ae60;"><i class="fas fa-check"></i></span>
                    </div>
                    {% endfor %}
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-receipt"></i> Desglose de Costos</h3>
                    <div class="info-item">
                        <span>Precio base por persona:</span>
                        <span>${{ tour.precio_base }}</span>
                    </div>
                    <div class="info-item">
                        <span>Número de personas:</span>
                        <span>{{ datos.personas }}</span>
                    </div>
                    <div class="info-item">
                        <span>Noches de estancia:</span>
                        <span>{{ datos.noches }}</span>
                    </div>
                    <div class="info-item">
                        <span>Categoría {{ datos.categoria.title() }}:</span>
                        <span>
                            {% if datos.categoria == 'economico' %}
                            (Ahorro 20%)
                            {% elif datos.categoria == 'premium' %}
                            (Premium +50%)
                            {% elif datos.categoria == 'lujo' %}
                            (Lujo +100%)
                            {% else %}
                            (Estándar)
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-item total-line">
                        <span><strong>Total del viaje:</strong></span>
                        <span><strong>${{ precio_final }} USD</strong></span>
                    </div>
                </div>
            </div>

            <div class="price-summary">
                <h2>Total de la Cotización</h2>
                <div class="total-price">${{ precio_final }} USD</div>
                <p>Precio por persona: ${{ (precio_final / datos.personas|int) | round(2) }} USD</p>
                <p><i class="fas fa-info-circle"></i> Precio sujeto a disponibilidad</p>
            </div>

            <div class="actions">
                {% if session.user_id %}
                <a href="{{ url_for('crear_itinerario') }}?paises={{ tour.pais }}" class="btn btn-success">
                    <i class="fas fa-plus-circle"></i> Crear Itinerario
                </a>
                {% else %}
                <a href="{{ url_for('login') }}" class="btn btn-success">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión para Reservar
                </a>
                {% endif %}
                <a href="{{ url_for('cotizar') }}" class="btn btn-primary">
                    <i class="fas fa-calculator"></i> Nueva Cotización
                </a>
                <a href="{{ url_for('destinos') }}" class="btn btn-secondary">
                    <i class="fas fa-globe-asia"></i> Ver Más Destinos
                </a>
                
                <!-- Botones adicionales -->
                <button class="btn btn-secondary" onclick="imprimirCotizacion()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button class="btn btn-primary" onclick="compartirCotizacion()">
                    <i class="fas fa-share-alt"></i> Compartir
                </button>
            </div>

            <div class="disclaimer">
                <p><i class="fas fa-clock"></i> Esta cotización es válida por 72 horas. Para confirmar tu reserva, inicia sesión y crea tu itinerario.</p>
                {% if not session.user_id %}
                <p style="margin-top: 10px;">
                    <a href="{{ url_for('register') }}" style="color: #3498db; text-decoration: underline;">
                        <i class="fas fa-user-plus"></i> ¿No tienes cuenta? Regístrate gratis
                    </a>
                </p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Datos embebidos para uso en JavaScript -->
    <div id="cotizacion-data" style="display:none;"
         data-tour-name="{{ tour.nombre }}"
         data-precio-final="{{ precio_final }}"
         data-pais="{{ tour.pais }}"
         data-personas="{{ datos.personas }}">
    </div>

    <script>
        // Animación de entrada
        document.addEventListener('DOMContentLoaded', function() {
            const quotationCard = document.querySelector('.quotation-card');
            setTimeout(() => {
                quotationCard.style.transition = 'all 0.5s ease';
                quotationCard.style.opacity = '1';
                quotationCard.style.transform = 'translateY(0)';
            }, 300);

            // Contador de precio animado (opcional)
            const totalPrice = document.querySelector('.total-price');
            const originalPrice = parseFloat("{{ precio_final }}");
            let currentPrice = 0;
            const duration = 1500; // 1.5 segundos
            const increment = originalPrice / (duration / 16); // 60fps
            
            function animatePrice() {
                if (currentPrice < originalPrice) {
                    currentPrice += increment;
                    if (currentPrice > originalPrice) currentPrice = originalPrice;
                    totalPrice.textContent = '$' + Math.round(currentPrice) + ' USD';
                    requestAnimationFrame(animatePrice);
                }
            }
            
            // Iniciar animación después de un breve retraso
            setTimeout(animatePrice, 500);
        });

        function imprimirCotizacion() {
            // Mostrar mensaje temporal
            const printBtn = event.target.closest('.btn');
            const originalHTML = printBtn.innerHTML;
            printBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Preparando...';
            
            setTimeout(() => {
                window.print();
                printBtn.innerHTML = originalHTML;
            }, 500);
        }

        function compartirCotizacion() {
            const data = document.getElementById('cotizacion-data');
            const tourName = data.dataset.tourName;
            const precio = data.dataset.precioFinal;
            const pais = data.dataset.pais;
            const personas = data.dataset.personas;
            
            const titulo = "Mi cotización de viaje - TRAVELASIA";
            const texto = `¡He cotizado ${tourName} para ${personas} personas por $${precio} USD! ✈️ Descubre más en: `;
            const url = window.location.href;
            
            // Cambiar texto del botón temporalmente
            const shareBtn = event.target.closest('.btn');
            const originalHTML = shareBtn.innerHTML;
            shareBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Compartiendo...';
            
            setTimeout(() => {
                if (navigator.share) {
                    navigator.share({
                        title: titulo,
                        text: texto,
                        url: url
                    }).then(() => {
                        shareBtn.innerHTML = '<i class="fas fa-check"></i> ¡Compartido!';
                        setTimeout(() => {
                            shareBtn.innerHTML = originalHTML;
                        }, 2000);
                    }).catch(() => {
                        shareBtn.innerHTML = originalHTML;
                    });
                } else {
                    // Fallback para copiar al portapapeles
                    navigator.clipboard.writeText(texto + url).then(() => {
                        shareBtn.innerHTML = '<i class="fas fa-check"></i> ¡Copiado!';
                        setTimeout(() => {
                            shareBtn.innerHTML = originalHTML;
                        }, 2000);
                    }).catch(() => {
                        alert('No se pudo copiar al portapapeles');
                        shareBtn.innerHTML = originalHTML;
                    });
                }
            }, 500);
        }
    </script>
</body>
</html>