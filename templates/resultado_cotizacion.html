<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultado de Cotizaci√≥n - TRAVELASIA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="header">
        <div class="logo">TRAVELASIA</div>
        <div class="nav">
            <a href="{{ url_for('index') }}">Inicio</a>
            <a href="{{ url_for('destinos') }}">Destinos</a>
            <a href="{{ url_for('cotizar') }}">Cotizar</a>
        </div>
        <div class="user-info">
            {% if session.user_name %}
                {{ session.user_name }}
            {% else %}
                <a href="{{ url_for('login') }}">Iniciar Sesi√≥n</a>
            {% endif %}
        </div>
    </div>

    <div class="container">
        <div class="quotation-card">
            <div class="success-header">
                <div class="success-icon">‚úì</div>
                <h1>¬°Cotizaci√≥n Generada Exitosamente!</h1>
                <p>Tu viaje a Asia est√° casi listo. Revisa los detalles de tu cotizaci√≥n:</p>
            </div>

            <div class="destination-info">
                <div class="info-section">
                    <h3>üìÖ Informaci√≥n del Viaje</h3>
                    <div class="info-item">
                        <span>Tour:</span>
                        <strong>{{ tour.nombre }}</strong>
                    </div>
                    <div class="info-item">
                        <span>Pa√≠s:</span>
                        <span>{{ tour.pais }}</span>
                    </div>
                    <div class="info-item">
                        <span>Ciudades:</span>
                        <span>{{ tour.ciudad }}</span>
                    </div>
                    <div class="info-item">
                        <span>Duraci√≥n:</span>
                        <span>{{ tour.duracion }}</span>
                    </div>
                </div>

                <div class="info-section">
                    <h3>üë• Detalles de la Cotizaci√≥n</h3>
                    <div class="info-item">
                        <span>Personas:</span>
                        <span>{{ datos.personas }}</span>
                    </div>
                    <div class="info-item">
                        <span>Noches:</span>
                        <span>{{ datos.noches }}</span>
                    </div>
                    <div class="info-item">
                        <span>Categor√≠a:</span>
                        <span>{{ datos.categoria.title() }}</span>
                    </div>
                </div>

                <div class="info-section">
                    <h3>‚úàÔ∏è Servicios Incluidos</h3>
                    {% for servicio in tour.incluye %}
                    <div class="info-item">
                        <span>{{ servicio }}:</span>
                        <span>‚úì Incluido</span>
                    </div>
                    {% endfor %}
                </div>

                <div class="info-section">
                    <h3>üí∞ Desglose de Costos</h3>
                    <div class="info-item">
                        <span>Precio base por persona:</span>
                        <span>${{ tour.precio_base }}</span>
                    </div>
                    <div class="info-item">
                        <span>N√∫mero de personas:</span>
                        <span>{{ datos.personas }}</span>
                    </div>
                    <div class="info-item">
                        <span>Noches de estancia:</span>
                        <span>{{ datos.noches }}</span>
                    </div>
                    <div class="info-item">
                        <span>Categor√≠a {{ datos.categoria.title() }}:</span>
                        <span>
                            {% if datos.categoria == 'economico' %}
                            (Ahorro 20%)
                            {% elif datos.categoria == 'premium' %}
                            (Premium +50%)
                            {% elif datos.categoria == 'lujo' %}
                            (Lujo +100%)
                            {% else %}
                            (Est√°ndar)
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-item total-line">
                        <span><strong>Total del viaje:</strong></span>
                        <span><strong>${{ precio_final }} USD</strong></span>
                    </div>
                </div>
            </div>

            <div class="price-summary">
                <h2>Total de la Cotizaci√≥n</h2>
                <div class="total-price">${{ precio_final }} USD</div>
                <p>Precio por persona: ${{ (precio_final / datos.personas) | round(2) }} USD</p>
                <p>* Precio sujeto a disponibilidad</p>
            </div>

            <div class="actions">
                {% if session.user_id %}
                <a href="{{ url_for('crear_itinerario') }}?paises={{ tour.pais }}" class="btn btn-success">Crear Itinerario</a>
                {% else %}
                <a href="{{ url_for('login') }}" class="btn btn-success">Iniciar Sesi√≥n para Reservar</a>
                {% endif %}
                <a href="{{ url_for('cotizar') }}" class="btn btn-primary">Nueva Cotizaci√≥n</a>
                <a href="{{ url_for('destinos') }}" class="btn btn-secondary">Ver M√°s Destinos</a>
                
                <!-- Botones adicionales -->
                <button class="btn btn-secondary" onclick="imprimirCotizacion()">üñ®Ô∏è Imprimir</button>
                <button class="btn btn-primary" onclick="compartirCotizacion()">üì§ Compartir</button>
            </div>

            <div class="disclaimer">
                <p>Esta cotizaci√≥n es v√°lida por 72 horas. Para confirmar tu reserva, inicia sesi√≥n y crea tu itinerario.</p>
                {% if not session.user_id %}
                <p style="margin-top: 10px;"><a href="{{ url_for('register') }}" style="color: #3498db; text-decoration: underline;">¬øNo tienes cuenta? Reg√≠strate gratis</a></p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Datos embebidos para uso en JavaScript -->
    <div id="cotizacion-data" style="display:none;"
         data-tour-name="{{ tour.nombre }}"
         data-precio-final="{{ precio_final }}"
         data-pais="{{ tour.pais }}">
    </div>

    <script>
        // Funcionalidad para imprimir la cotizaci√≥n
        function imprimirCotizacion() {
            window.print();
        }

        // Funcionalidad para compartir
        function compartirCotizacion() {
            const data = document.getElementById('cotizacion-data');
            const tourName = data.dataset.tourName;
            const precio = data.dataset.precioFinal;
            const pais = data.dataset.pais;
            
            const titulo = "Mi cotizaci√≥n de viaje - TRAVELASIA";
            const texto = `¬°He cotizado un viaje incre√≠ble con TRAVELASIA! ${tourName} por $${precio}`;
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: titulo,
                    text: texto,
                    url: url
                });
            } else {
                // Fallback para copiar al portapapeles
                navigator.clipboard.writeText(texto + "\n" + url).then(function() {
                    alert('¬°Cotizaci√≥n copiada al portapapeles!');
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Animaci√≥n de entrada
            const quotationCard = document.querySelector('.quotation-card');
            quotationCard.style.opacity = '0';
            quotationCard.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                quotationCard.style.transition = 'all 0.5s ease';
                quotationCard.style.opacity = '1';
                quotationCard.style.transform = 'translateY(0)';
            }, 300);
        });
    </script>
</body>
</html>